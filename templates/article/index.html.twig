{% extends 'base.html.twig' %}

<<<<<<< HEAD
{% block title %}إدارة المنتجات{% endblock %}

{% block body %}
	<div class="container mt-4">
		<div class="card shadow-sm">
			<div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
				<h2 class="mb-0">قائمة المنتجات ({{ articles|length }})</h2>
				<a href="{{ path('article_new') }}" class="btn btn-light">
					<i class="bi bi-plus-circle"></i> إضافة منتج
				</a>
=======
{% block title %}إدارة المنتجات
{% endblock %}

{% block body %}
{% include "layout/header.html.twig" %}
	<div
		class="container mt-4">
		<!-- Formulaire d'ajout -->
		<div class="card mb-4">
			<div class="card-header">
				<h2>➕ إضافة منتج جديد</h2>
			</div>
			<div class="card-body">
				{{ form_start(form, {
    'attr': {'id': 'articleForm', 'data-action': path('article_create_ajax')}
}) }}
				<div class="row">
					<div class="col-md-12">
						{{ form_row(form.nom) }}
						{{ form_row(form.description) }}
						{{ form_row(form.categorie) }}
						{{ form_row(form.fournisseur) }}
					</div>

				</div>
				<button type="submit" class="btn btn-primary mt-2">
					<i class="bi bi-save"></i>
					حفظ المنتج
				</button>
				{{ form_end(form) }}
			</div>
		</div>

		<!-- Tableau des articles -->
		<div class="card">
			<div class="card-header d-flex justify-content-between align-items-center">
				<h2>قائمة المنتجات ({{ articles|length }})</h2>
>>>>>>> d6476d60ab6c137fd57e0e94d3b5e16948081daa
			</div>
			<div class="card-body p-0">
				{% if articles is not empty %}
					<div class="table-responsive">
						<table class="table table-hover align-middle" id="articlesTable">
							<thead class="table-light">
								<tr>
									<th>المرجع</th>
									<th>الاسم</th>
									<th>التصنيف</th>
									<th>المورّد</th>
									<th>عتبة التنبيه</th>
									<th>الحالة</th>
<<<<<<< HEAD
									<th>الإجراءات</th>
=======
                                    <th>الإجراءات</th>
>>>>>>> d6476d60ab6c137fd57e0e94d3b5e16948081daa
								</tr>
							</thead>
							<tbody>
								{% for a in articles %}
									<tr>
										<td dir="ltr">{{ a.reference }}</td>
										<td>{{ a.nom }}</td>
										<td>{{ a.categorie ? a.categorie.nom : '—' }}</td>
										<td>{{ a.fournisseur ? a.fournisseur.nom : '—' }}</td>
										<td>{{ a.seuilalerte }}</td>
										<td>
											{% if a.stock < a.seuilalerte %}
												<span class="badge bg-danger">⚠️ منخفض</span>
											{% else %}
												<span class="badge bg-success">✅ كافٍ</span>
											{% endif %}
										</td>
										<td>
											<a href="{{ path('article_edit', {'id': a.id}) }}" class="btn btn-sm btn-outline-primary" title="تعديل">
												<i class="bi bi-pencil"></i>
											</a>
											<button type="button" class="btn btn-sm btn-outline-danger delete-article" data-id="{{ a.id }}" title="حذف">
												<i class="bi bi-trash"></i>
											</button>
										</td>
									</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				{% else %}
					<div class="text-center py-4 text-muted">لا توجد منتجات.</div>
				{% endif %}
			</div>
		</div>
	</div>
{% endblock %}

{% block javascripts %}
	 <script>
	document.addEventListener("DOMContentLoaded", function() {
<<<<<<< HEAD
	    // Initialiser DataTables
	    new DataTable('#articlesTable', {
	        language: { url: 'https://cdn.datatables.net/plug-ins/2.0.8/i18n/ar.json    ' },
	        paging: true,
	        pageLength: 5,
=======
	    // Initialiser Select2 pour catégorie et fournisseur
	    document.querySelectorAll('.select2-entity').forEach(function(el) {
	        $(el).select2({
	            theme: "bootstrap-5",
	            width: '100%',
	            dir: "rtl",
	            placeholder: "ابحث أو اختر...",
	            language: {
	                noResults: function() { return "لا توجد نتائج"; },
	                searching: function() { return "جارٍ البحث…"; }
	            }
	        });
	    });

	    // Initialiser DataTables
	    new DataTable('#articlesTable', {
	        language: { url: 'https://cdn.datatables.net/plug-ins/2.0.8/i18n/ar.json' },
	        paging: true,
	        pageLength: 15,
>>>>>>> d6476d60ab6c137fd57e0e94d3b5e16948081daa
	        searching: true,
	        info: true,
	        order: [[0, 'asc']]
	    });
	});
	</script>
<<<<<<< HEAD
{% endblock %}
=======
{% endblock %}
>>>>>>> d6476d60ab6c137fd57e0e94d3b5e16948081daa
