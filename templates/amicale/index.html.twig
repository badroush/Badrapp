{% extends 'base.html.twig' %}

{% block title %}إدارة الودادية
{% endblock %}

{% block body %}
	<div class="container-fluid mt-5">
		<div class="row">
			<div class="col-lg-12 col-md-12">
				<div class="card shadow-lg border-0">
					<div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
						<h2 class="mb-0">إدارة الودادية</h2>
						<p class="mb-0 text-light">إدارة الطلبات والمستفيدين</p>
					</div>
					<div
						class="card-body p-5">
						<!-- Bouton Ajouter/Submit -->
						<div class="d-flex justify-content-between align-items-center mb-4">
							{% if is_admin %}
								<a href="{{ path('app_demande_nouvelle') }}" class="btn btn-primary px-4 py-2">
									<i class="fas fa-plus-circle"></i>
									إضافة طلب جديد
								</a>
							
								<a href="{{ path('app_demande_nouvelle') }}" class="btn btn-success px-4 py-2">
									<i class="fas fa-paper-plane"></i>
									تقديم طلب
								</a>
							{% elseif is_granted('ROLE_USER') %}
								<a href="{{ path('app_demande_nouvelle') }}" class="btn btn-success px-4 py-2">
									<i class="fas fa-paper-plane"></i>
									تقديم طلب
								</a>
							{% endif %}

						</div>

						<!-- Section Offres -->
						<div class="mb-5">
							<h3 class="text-primary mb-3">العروض الحالية</h3>
							<div class="row">
								{% for offre in offres %}
									<div class="col-md-6 col-lg-4 mb-3">
										<div class="card border-light shadow-sm">
											<div class="card-body">
												<h5 class="card-title">{{ offre.nom }}</h5>
												<p class="card-text">
													<span class="badge bg-secondary">{{ offre.etat }}</span>
												</p>
											</div>
										</div>
									</div>
								{% endfor %}
							</div>
						</div>

						<!-- Section Demandes -->
						<div>
							<h3 class="text-primary mb-3">طلباتي</h3>
							<div class="table-responsive">
								<table class="table table-hover table-bordered">
									<thead class="table-light">
										<tr>
											<th>العرض</th>
											<th>التاريخ</th>
											<th>عدد الأشهر</th>
											<th>المبلغ الإجمالي</th>
											<th>الحالة</th>
											<th>الإجراءات</th>
										</tr>
									</thead>
									<tbody>
										{% set statuts = {
											'en_attente': 'في الانتظار',
											'valide': 'مقبول',
											'refuse': 'مرفوض',
											'paye': 'مدفوع'
										} %}
										{% for demande in demandes %}
											<tr>
												<td>{{ demande.offre.nom }}</td>
												<td>{{ demande.dateDemande|date('Y-m-d') }}</td>
												<td>{{ demande.offre.dureeEnMois ?? '—' }}</td>
												<td>
													{% if demande.offre.total is defined and demande.offre.total %}
														{{ demande.offre.total|number_format(3, '.', ',') }}
													{% else %}
														—
													{% endif %}
												</td>
												<td>
													<span class="badge
												{% if demande.statut == 'en_attente' %}bg-warning
												{% elseif demande.statut == 'valide' %}bg-success
												{% elseif demande.statut == 'refuse' %}bg-danger
												{% elseif demande.statut == 'paye' %}bg-info
												{% else %}bg-secondary
												{% endif %}">
														{{ statuts[demande.statut] ?? 'غير معروف' }}
													</span>
												</td>
												<td>
													{% if is_admin %}
														<a href="{{ path('app_demande_edit', {'id': demande.id}) }}" class="btn btn-sm btn-warning">
															<i class="fas fa-edit"></i>
															تعديل
														</a>
													{% endif %}
												</td>
											</tr>
										{% endfor %}
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<style>
		.card {
    border-radius: 12px;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    margin: 0;
    border: none;
}
		.card:hover {
			transform: translateY(-5px);
			box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
		}
		.btn {
			border-radius: 8px;
			font-weight: 500;
		}
		.table th {
			font-weight: 600;
		}
		.badge {
			font-size: 0.85em;
		}
	</style>

{% endblock %}
