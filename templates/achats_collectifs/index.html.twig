{% extends 'base.html.twig' %}

{% block title %}Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©
{% endblock %}

{% block body %}
	<div class="container-fluid mt-5">
		<div class="row">
			<div class="col-12">
				<div class="card shadow-lg border-0">
					<div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
						<h2 class="mb-0">ğŸ›’ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©</h2>
						<p class="mb-0 text-light">Ø§Ø®ØªØ± ÙØµÙ„ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</p>
					</div>
					<div class="card-body p-5">
    <div class="row">
        {% for chapitre in chapitres %}
    {% set totalAchete = totauxAchetes[chapitre.id]|default(0) %}
    {% set budget = chapitre.chapitreBudget.budgets|first %} <!-- RÃ©cupÃ¨re le premier budget -->
    {% set montantBudget = budget.montant %}
    {% set reste = montantBudget - totalAchete %}
    
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="card border-light shadow-sm h-100">
            <div class="card-body d-flex flex-column">
                <h5 class="card-title text-primary">{{ chapitre.nom }}</h5>
                
                <p class="card-text flex-grow-1">
                    {% if chapitre.chapitreBudget %}
                        <small class="text-muted">Ø§Ù„ÙØµÙ„: {{ chapitre.chapitreBudget.nom }}</small><br>
                        <small class="text-success">Ø§Ù„Ù…Ø¨Ù„Øº: {{ montantBudget|number_format(3, '.', ',') }} DT</small><br>
                        <small class="text-warning">Ø§Ù„Ù…Ø´ØªØ±Ù‰: {{ totalAchete|number_format(3, '.', ',') }} DT</small><br>
                        <small class="text-info">Ø§Ù„Ø¨Ø§Ù‚ÙŠ: {{ reste|number_format(3, '.', ',') }} DT</small>
                    {% endif %}
                </p>
                
                <a href="{{ path('app_achats_collectifs_chapitre', {'id': chapitre.id}) }}" class="btn btn-outline-primary mt-auto">
                    <i class="fas fa-eye me-2"></i>
                    Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ§Ø¯
                </a>
            </div>
        </div>
    </div>
{% endfor %}
    </div>
</div>
				</div>
			</div>
		</div>
	</div>

	<style>
		.card {
			border-radius: 12px;
			transition: transform 0.3s ease, box-shadow 0.3s ease;
		}
		.card:hover {
			transform: translateY(-5px);
			box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
		}
		.btn {
			border-radius: 8px;
			font-weight: 500;
		}
	</style>
{% endblock %}
